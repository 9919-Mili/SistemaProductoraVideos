@startuml 01-diagrama-clases-final-refinado

' Diagrama de clases refinado (copia consistente con matrices CLAE y CRC)

abstract class Archivo {
    - ubicacion: string
    - nombreArchivo: string
}

class Sistema {
    + gestionarProyectos(): void
    + gestionarUsuarios(): void
    + gestionarReportes(): void
    + notificarUsuarios(notificacion: Notificacion): void
    + accesoAutenticado(email: string, password: string): bool
}

class Usuario {
    - nombre: string
    - rol: string
    - credenciales: string
    - proyectos: List<Proyecto>
    - notificaciones: List<Notificacion>
    + autenticar(email: string, password: string): bool
    + consultarProyectosAsignados(): List<Proyecto>
    + recibirNotificacion(notificacion: Notificacion): void
}

class Cliente {
    - nombre: string
    - contacto: string
}

class Proyecto {
    - nombre: string
    - tipo: string
    - fechaInicio: Date
    - fechaFin: Date
    - responsableGeneral: Usuario
    - etapas: List<Etapa>
    - clientes: List<Cliente>
    + crearProyecto(nombre: string, tipo: string, fechaInicio: Date, fechaFin: Date, responsable: Usuario): Proyecto
    + consultarProyectosActivos(): List<Proyecto>
    + asignarResponsable(nombre: string, responsable: Usuario): bool
    + gestionarEtapas(): void
    + consultarFechaInicio(): Date
    + consultarFechaEntrega(): Date
    + agregarObservaciones(nombre: string, descripcion: string): int
    + registrarFechas(nombre: string, fechaInicio: Date, fechaFin: Date): bool
    + buscarCliente(nombre: string): Cliente
}

class Etapa {
    - nombre: string
    - estado: string
    - responsableEtapa: Usuario
    - adjuntos: List<Adjunto>
    - observaciones: List<Observacion>
    + actualizarEstado(nuevoEstado: string): bool
    + asignarResponsable(usuario: Usuario): bool
    + agregarObservacion(texto: string, autor: Usuario): Observacion
    + agregarAdjunto(url: string, descripcion: string, nombreArchivo: string): Adjunto
    + listarEtapasPorProyecto(nombreProyecto: string): List<Etapa>
}

class Observacion {
    - texto: string
    - fecha: Date
    - autor: Usuario
    + crearObservacion(nombreEtapa: Etapa, nombreUsuario: Usuario, texto: string): Observacion
    + actualizarObservacion(nombreEtapa: Etapa, texto: string): bool
    + editarObservacion(texto: string): Observacion
}


class Adjunto {
    - url: string
    - descripcion: string
    - nombreArchivo: string
    + vincularRecurso(url: string, descripcion: string, nombreArchivo: string): Adjunto
}

class Notificacion {
    - mensaje: string
    - fechaEnvio: Date
    - tipo: string
    - destinatario: Usuario
    + prepararNotificacion(mensaje: string, fechaEnvio: Date, tipo: string, destinatario: Usuario): void
    + enviarNotificacion(destinatario: Usuario): bool
    + enviarNotificacionResponsable(nombreEtapa: string, mensaje: string): bool
}

class Reporte {
    - nombre: string
    - estadisticas: string
    - tipoEstadisticas: string
    - periodoInicio: Date
    - periodoFin: Date
    + generarReporte(nombre: string, estadisticas: string, tipoEstadisticas: string, periodoInicio: Date, periodoFin: Date): Reporte
    + consultarEstadisticas(): List<Estadistica>
    + descargarReporte(): File
}

class Estadistica {
    - tipo: string
    - valor: string
    + generarEstadisticas(filtro: FiltroBusqueda): List<Estadistica>
    + listarEstadisticas(): List<Estadistica>
}


' Herencia / Especializaci√≥n
Archivo <|-- Adjunto

' Relaciones y multiplicidades (derivadas de matrices CLAE y tarjetas CRC)
Proyecto "1" *-- "0..*" Etapa : etapas
Etapa "1" o-- "0..*" Observacion : observaciones
Etapa "1" o-- "0..*" Adjunto : adjuntos
Etapa "0..1" --> "1" Usuario : responsableEtapa
Proyecto "1" --> "0..*" Usuario : responsableGeneral
Observacion "1" --> "1" Usuario : autor
Notificacion "1" --> "1" Usuario : destinatario
Proyecto "1" --> "0..*" Cliente : clientes
Reporte "1" --> "0..*" Estadistica : estadisticas
Sistema "1" --> "0..*" Proyecto
Sistema "1" --> "0..*" Usuario
Sistema "1" --> "0..*" Reporte
Sistema "1" --> "0..*" Notificacion

@enduml

@startuml Diagrama_Actividades_Consultar_Proyectos_Activos
title Diagrama de Actividades - Caso de Uso 04: Consultar Estadisticas
|Productora General/Responsable de Etapa|
|Usuario/Cliente|
|Sistema|
|Recursos|
|Usuario/Cliente|
start
:Abrir aplicación;
:Seleccionar "Estadisticas";

|Sistema|
if (¿Usuario autenticado?) then (no)
  :Mostrar pantalla de login;

|Usuario/Cliente|
  :Ingresar credenciales;

|Sistema|
:Validar credenciales;
while (Credenciales válidas?) is (no)
  :Mostrar error de login;
|Usuario/Cliente|
  :Modificar credenciales ingresadas;
endwhile (sí)
endif

|Sistema|
  :Autenticar usuario;
  :Mostrar pantalla de Estadisticas;
  

if (Permisos para crear Reporte?) then (no)
  |Usuario/Cliente| 
  :Seleccionar un Reporte Existente;
  |Productora General/Responsable de Etapa|
  else (si)
  if (Crear un Nuevo Reporte?) then (si)
  :Seleccionar la consulta "Crear Nuevo Reporte";
  :Seleccionar filtro;
  :Aplicar filtros;

|Sistema|
  :Recopilacion de datos filtrados;

|Recursos|
  :Sincronizar datos;
  
|Sistema|
  :Generar Reporte de Estadisticas;
  :Almacenar Reporte de Estadisticas;
  :Notificar Usuario creador de consulta;

  |Productora General/Responsable de Etapa|
  else (no)
  :Seleccionar un Reporte Existente;
  endif
endif 

|Sistema|
  :Mostrar Reporte al usuario;

|Usuario/Cliente|
if (Descargar Reporte?) then (si)
  :Seleccionar opción "Descargar Reporte";

  |Sistema| 
  :Procesar descarga del Reporte;

  |Usuario/Cliente|
  :Reporte Guardado Localmente;
  else (no)
endif

if (Consultar Reporte Localmente?) then (si)
else(no)
  :Consultar Reporte de Estadisticas;
  endif
  :Cerrar vista de Estadisticas;
stop

@enduml